{% extends "base.html" %}
{% block title %}Home Loan EMI Calculator – {{ settings_obj.site_name }}{% endblock %}

{% block content %}

<!-- HERO START HERE -->
<section class="bg-[#eef4f8] pt-16 pb-28 relative overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row items-center justify-between gap-8">

    <!-- LEFT CONTENT -->
    <div class="max-w-xl">

      <!-- Breadcrumb -->
      <p class="text-sm text-gray-600 mb-4">
        Home <span class="mx-1">›</span> 
        <span class="text-green-600 font-medium">Calculator</span> 
      </p>

      <!-- Title -->
      <h1 class="text-4xl md:text-5xl font-extrabold text-[#1f4e79] mb-4 tracking-wide">
        EMI Calculator
      </h1>

      <!-- Hero Content -->
      <p class="text-gray-600 text-lg leading-relaxed">
        Easily calculate your home loan EMI, interest amount and total payable 
        with our smart EMI calculator — plan your property investment better.
      </p>

    </div>

    <!-- RIGHT IMAGE -->
        <div class="md:relative absolute right-6 bottom-0 md:bottom-0 flex justify-end pointer-events-none">
          <img src="https://housiey.com/_next/image?url=%2Fassets%2Fimage%2Fcalculator.png&w=384&q=75" alt="EMI Calculator" class="w-[260px] md:w-[400px] object-contain translate-y-6">
        </div>

  </div>
</section>
<!-- HERO END HERE -->

<!-- EMI PDF -->
<div id="emiPdfContent">
  <!-- CONVERTER START HERE -->
  <section class="max-w-7xl mx-auto px-6 py-14 grid md:grid-cols-2 gap-8">

      <!-- LEFT -->
      <div class="bg-white border border-gray-200 p-10 space-y-10">

        <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-3">
          <span class="w-1 h-7 bg-green-600 rounded"></span> Converter
        </h2>

        <!-- Loan -->
        <div class="space-y-2">
          <div class="flex justify-between text-sm font-medium text-gray-700">
            <span>Loan Amount</span>
            <span id="loanValue" class="text-orange-600 font-semibold">3.45 Cr</span>
          </div>
          <input id="loan" type="range"
            class="w-full h-1.5 rounded bg-gray-200 accent-orange-500">
        </div>

        <!-- Rate -->
        <div class="space-y-2">
          <div class="flex justify-between text-sm font-medium text-gray-700">
            <span>Interest Rate</span>
            <span id="rateValue" class="text-orange-600 font-semibold">7.7%</span>
          </div>
          <input id="rate" type="range"
            class="w-full h-1.5 rounded bg-gray-200 accent-orange-500">
        </div>

        <!-- Years -->
        <div class="space-y-2">
          <div class="flex justify-between text-sm font-medium text-gray-700">
            <span>Tenure</span>
            <span id="yearValue" class="text-orange-600 font-semibold">13 Years</span>
          </div>
          <input id="years" type="range"
            class="w-full h-1.5 rounded bg-gray-200 accent-orange-500">
        </div>

      </div>

      <!-- RIGHT -->
      <div class="bg-white border p-8 text-center">

          <h3 class="text-lg font-semibold pb-3 border-b mb-4">
            Payment Split
          </h3>

          <div class="max-w-[180px] mx-auto">
            <canvas id="emiChart" height="190"></canvas>
          </div>

          <div class="flex justify-center gap-6 mt-4 text-sm">
            <span class="flex items-center gap-1 text-green-600">
              <span class="w-2.5 h-2.5 bg-green-600"></span> Interest
            </span>
            <span class="flex items-center gap-1 text-blue-900">
              <span class="w-2.5 h-2.5 bg-blue-900"></span> Principal
            </span>
          </div>

    </div>

  </section>
  <!-- CONVERTER END HERE -->

  <!-- TOTAL INFORMATION -->
  <section class="bg-gray-50 py-12">
    <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-3 gap-6">

      <!-- EMI -->
      <div class="bg-white border p-6 text-center">
        <p class="text-sm text-gray-500 mb-1">Monthly EMI</p>
        <h3 id="monthlyEmi" class="text-2xl font-bold text-blue-900">₹0</h3>
      </div>

      <!-- INTEREST -->
      <div class="bg-white border p-6 text-center">
        <p class="text-sm text-gray-500 mb-1">Total Interest Payable</p>
        <h3 id="totalInterest" class="text-2xl font-bold text-blue-900">₹0</h3>
      </div>

      <!-- TOTAL -->
      <div class="bg-white border p-6 text-center">
        <p class="text-sm text-gray-500 mb-1">Total Payment</p>
        <h3 id="totalPayment" class="text-2xl font-bold text-green-600">₹0</h3>
      </div>

    </div>
  </section>
  <!-- TOTAL INFORMATION END HERE -->

  <!-- AMORTIZATION SCHEDULE -->
  <section class="max-w-7xl mx-auto px-6 py-14">

    <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-2 mb-6">
      <span class="w-1 h-6 bg-green-600"></span> Amortization Schedule
    </h2>

    <div class="flex justify-end mb-4 hidden md:block">
      <button id="downloadEmi"
        class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 text-sm font-medium transition">
        Download EMI Report
      </button>
    </div>


    <p class="text-gray-600 mb-1">
      Detailed amortization schedule will be available soon.
    </p>

    <div class="w-full overflow-x-auto">
    <table class="w-full min-w-[900px] text-sm text-center border-collapse border border-gray-300">

      <thead class="bg-gray-100">
        <tr>
          <th class="p-3 border border-gray-300">Year</th>
          <th class="p-3 border border-gray-300">Principal</th>
          <th class="p-3 border border-gray-300">Interest</th>
          <th class="p-3 border border-gray-300">Total</th>
          <th class="p-3 border border-gray-300">Balance</th>
        </tr>
      </thead>

      <tbody id="amortizationBody"></tbody>

    </table>
  </div>


  </section>
  <!-- AMORTIZATION SCHEDULE END HERE -->
</div>
<!-- EMI PDF END-->


<!-- EMI GUIDE CONTENT -->
 <section class="bg-white py-16">
  <div class="max-w-7xl mx-auto px-6 space-y-12">

    <!-- MAIN INTRO -->
    <div class="max-w-3xl">
      <h2 class="text-3xl font-bold text-[#1f4e79] mb-4">
        EMI Calculator for Home Loans
      </h2>

      <p class="text-gray-600 leading-relaxed">
        Buying a home is a significant financial decision, and most homebuyers rely on loans 
        to finance their purchases. Whether you are purchasing a house, a plot, or constructing 
        a new home, understanding your Equated Monthly Installment (EMI) is essential.
      </p>

      <p class="text-gray-600 mt-3 leading-relaxed">
        EMI is a fixed monthly payment consisting of both principal and interest, helping you 
        repay your loan in a structured and stress-free manner.
      </p>
    </div>

    <!-- WHY EMI CALCULATOR -->
    <div class="grid md:grid-cols-2 gap-10">

      <div>
        <h3 class="text-xl font-semibold mb-3">Why Use an EMI Calculator?</h3>
        <ul class="space-y-2 text-gray-600 list-disc pl-5">
          <li>Instant EMI calculation</li>
          <li>Total interest breakdown</li>
          <li>Loan planning made easier</li>
          <li>Prepayment impact analysis</li>
        </ul>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-3">Key Factors Affecting EMI</h3>
        <ul class="space-y-2 text-gray-600 list-disc pl-5">
          <li>Loan Amount</li>
          <li>Interest Rate</li>
          <li>Loan Tenure</li>
        </ul>
      </div>

    </div>

    <!-- EMI FORMULA -->
    <div class="bg-gray-50 border p-8 max-w-3xl">
      <h3 class="text-xl font-semibold mb-3">EMI Calculation Formula</h3>

      <p class="text-gray-700 font-mono bg-white p-4 border inline-block">
        EMI = [P × R × (1+R)ⁿ] ÷ [(1+R)ⁿ − 1]
      </p>

      <ul class="mt-4 text-gray-600 space-y-1">
        <li><strong>P</strong> = Loan Amount</li>
        <li><strong>R</strong> = Monthly Interest Rate</li>
        <li><strong>N</strong> = Number of Monthly Installments</li>
      </ul>
    </div>

    <!-- BENEFITS -->
    <div>
      <h3 class="text-xl font-semibold mb-4">Benefits of EMI Planning</h3>

      <div class="grid sm:grid-cols-2 md:grid-cols-4 gap-4 text-center">

        <div class="border p-4">
          Better Budgeting
        </div>

        <div class="border p-4">
          Financial Control
        </div>

        <div class="border p-4">
          Reduced Stress
        </div>

        <div class="border p-4">
          Smarter Decisions
        </div>

      </div>
    </div>

    <!-- SUMMARY -->
    <div class="max-w-3xl">
      <h3 class="text-xl font-semibold mb-3">Conclusion</h3>

      <p class="text-gray-600 leading-relaxed">
        An EMI calculator is an essential financial planning tool that provides transparency 
        and clarity before taking a loan. It helps you understand repayment structure, interest 
        costs, and long-term financial commitments — allowing you to make smarter property 
        investment decisions.
      </p>
    </div>

  </div>
</section>
<!-- EMI GUIDE CONTENT END HERE -->

<!-- Difference Between Home Loan and Plot Loan EMI Calculations -->
  <div class="max-w-7xl mx-auto px-6">
  <div class="border-t border-gray-200 my-16"></div>
  </div>

  <section class="bg-white py-16">
  <div class="max-w-7xl mx-auto px-6">

      <h2 class="text-3xl font-bold text-[#1f4e79] mb-8">
      Difference Between Home Loan and Plot Loan EMI Calculations
      </h2>

      <div class="overflow-x-auto border">
          <table class="w-full min-w-[600px] text-sm text-center border-collapse">

          <thead class="bg-gray-100">
              <tr>
              <th class="p-3 border">Feature</th>
              <th class="p-3 border">Home Loan</th>
              <th class="p-3 border">Plot Loan</th>
              </tr>
          </thead>

          <tbody>

              <tr>
              <td class="p-3 border font-medium">Purpose</td>
              <td class="p-3 border">For purchasing a house</td>
              <td class="p-3 border">For purchasing land</td>
              </tr>

              <tr class="bg-gray-50">
              <td class="p-3 border font-medium">Interest Rate</td>
              <td class="p-3 border">Usually lower</td>
              <td class="p-3 border">Slightly higher</td>
              </tr>

              <tr>
              <td class="p-3 border font-medium">Loan Tenure</td>
              <td class="p-3 border">Up to 30 years</td>
              <td class="p-3 border">Up to 20 years</td>
              </tr>

              <tr class="bg-gray-50">
              <td class="p-3 border font-medium">Tax Benefits</td>
              <td class="p-3 border">Available</td>
              <td class="p-3 border">Limited</td>
              </tr>

          </tbody>
          </table>
      </div>


  </div>
  </section>


  <div class="max-w-7xl mx-auto px-6">
  <div class="border-t border-gray-200 my-16"></div>
  </div>
<!-- Difference Between Home Loan and Plot Loan EMI Calculations End-->


<script>
  document.addEventListener("DOMContentLoaded", function(){

  const loan = document.getElementById("loan");
  const rate = document.getElementById("rate");
  const years = document.getElementById("years");

  const loanValue = document.getElementById("loanValue");
  const rateValue = document.getElementById("rateValue");
  const yearValue = document.getElementById("yearValue");

  loan.min = 100000;
  loan.max = 300000000;
  loan.step = 100000;
  loan.value = 34500000;

  rate.min = 5;
  rate.max = 30;
  rate.step = 0.1;
  rate.value = 7.7;

  years.min = 1;
  years.max = 30;
  years.value = 13;

  const ctx = document.getElementById("emiChart");

  let chart = new Chart(ctx, {
    type: "pie",
    data: {
      labels: ["Interest", "Principal"],
      datasets: [{
        data: [0,0],
        backgroundColor: ["#059669", "#1e3a8a"]
      }]
    },
    options: { plugins:{ legend:{ display:false } } }
  });

  function formatCr(val){
    return (val / 10000000).toFixed(2) + " Cr";
  }

  function calculate(){

    let P = +loan.value;
    let r = rate.value / 12 / 100;
    let yearsCount = years.value;
    let n = yearsCount * 12;

    let emi = P * r * Math.pow(1+r,n) / (Math.pow(1+r,n)-1);
    let total = emi * n;
    let interestTotal = total - P;

    loanValue.textContent = formatCr(P);
    rateValue.textContent = rate.value + "%";
    yearValue.textContent = yearsCount + " Years";

    monthlyEmi.textContent = "₹" + Math.round(emi).toLocaleString("en-IN");
    totalInterest.textContent = "₹" + Math.round(interestTotal).toLocaleString("en-IN");
    totalPayment.textContent = "₹" + Math.round(total).toLocaleString("en-IN");

    chart.data.datasets[0].data = [interestTotal, P];
    chart.update();

    let balance = P;
    amortizationBody.innerHTML = "";
    let currentYear = new Date().getFullYear();

    for(let y=1;y<=yearsCount;y++){

      let yearlyPrincipal=0;
      let yearlyInterest=0;

      for(let m=1;m<=12;m++){
        let interestMonth = balance * r;
        let principalMonth = emi - interestMonth;

        yearlyInterest += interestMonth;
        yearlyPrincipal += principalMonth;
        balance -= principalMonth;
        if(balance<0) balance=0;
      }

      amortizationBody.innerHTML += `
        <tr>
          <td class="p-3 border text-green-600">${currentYear+y-1}</td>
          <td class="p-3 border">₹${Math.round(yearlyPrincipal).toLocaleString("en-IN")}</td>
          <td class="p-3 border">₹${Math.round(yearlyInterest).toLocaleString("en-IN")}</td>
          <td class="p-3 border">₹${Math.round(yearlyPrincipal+yearlyInterest).toLocaleString("en-IN")}</td>
          <td class="p-3 border">₹${Math.round(balance).toLocaleString("en-IN")}</td>
        </tr>
      `;
    }
  }

  loan.addEventListener("input", calculate);
  rate.addEventListener("input", calculate);
  years.addEventListener("input", calculate);

  calculate(); // initial run

  document.getElementById("downloadEmi").onclick = async function(){

    const { jsPDF } = window.jspdf;

    const canvas = await html2canvas(document.getElementById("emiPdfContent"),{
      scale:2
    });

    const img = canvas.toDataURL("image/png");
    const pdf = new jsPDF("p","mm","a4");

    const w = 210;
    const h = canvas.height * w / canvas.width;

    let y = 0;
    let left = h;

    while(left>0){
      pdf.addImage(img,"PNG",0,y,w,h);
      left -= 297;
      y -= 297;
      if(left>0) pdf.addPage();
    }

    pdf.save("EMI_Report.pdf");
  };

});
</script>

{% endblock %}
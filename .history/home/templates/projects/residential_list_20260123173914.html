
{% extends 'base.html' %} 
{% load static %}
{% load utility_tags %} 
{% load humanize %} 
{% block title %}{{ site_settings.meta_title|default:'Best Real Estate Deals' }}{% endblock %}
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<style>
.slider-animation {
    display: flex;
    animation: slide 12s infinite linear;
}
.slider-animation img {
    width: 100%;
    flex-shrink: 0;
    object-fit: cover;
}

@keyframes slide {
    0% { transform: translateX(0); }
    20% { transform: translateX(0); }

    25% { transform: translateX(-100%); }
    45% { transform: translateX(-100%); }

    50% { transform: translateX(-200%); }
    70% { transform: translateX(-200%); }

    75% { transform: translateX(-300%); }
    100% { transform: translateX(-300%); }
}
.nice-scroll::-webkit-scrollbar { width: 6px; }
.nice-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
.nice-scroll::-webkit-scrollbar-track { background: transparent; }

.filter-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s ease;
}
.filter-body.open {
  max-height: 420px;
}
</style>

{% block content %}




<!-- ================= MAIN CONTAINER ================= -->
<div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">

  <aside class="space-y-4 md:space-y-5 lg:space-y-6 lg:sticky lg:top-24">

    <form class="bg-white shadow-md md:shadow-lg rounded-2xl p-4 md:p-5 lg:p-6 space-y-4 md:space-y-5" id="filterForm" method="GET">

      <!-- ================= HEADER ================= -->
      <div class="border-b pb-3">
        <h3 class="font-bold text-gray-800 text-lg">
          Advanced Search
        </h3>
      </div>

    <!-- ================= Locality ================= -->
      <div class="border overflow-hidden bg-white">

        <!-- header -->
        <div class="flex items-center justify-between px-4 py-3">
          <button type="button" class="flex-1 flex items-center justify-between text-left" onclick="toggleFilter('localityBody','localityArrow')">

            <h4 class="text-sm font-semibold text-gray-800">Locality</h4>

            <svg id="localityArrow" class="w-4 h-4 text-gray-500 transition-transform duration-300 rotate-180" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <!-- âœ… clear all filters -->
          <a class="text-sm font-semibold text-blue-600 hover:text-blue-700 ml-2">
            Clear
          </a>
        </div>

        <!-- body -->
        <div id="localityBody" class="filter-body open">
          <div class="px-4 pb-4 space-y-3">

            <!-- search -->
            <div class="relative">
              <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
              <input id="localitySearch" type="text" placeholder="Search locality..." class="w-full border px-10 py-2 text-sm outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-300" oninput="filterLocality()" />
            </div>

            <!-- list -->
            <div class="border p-2 max-h-[220px] overflow-auto nice-scroll" id="localityList">

            {% for locality in available_localities %}
              <label class="locality-item flex items-center gap-3 px-2 py-2 rounded-md hover:bg-gray-50 cursor-pointer">
                <input type="checkbox" name="locality" value="{{ locality.id }}" class="locality-check w-4 h-4" onchange="submitFilters()"
                  {% if locality.id|stringformat:"s" in selected_locality_ids %}
                    checked
                  {% endif %}>
                <span class="text-sm text-gray-800">{{ locality.name }}</span>
              </label>
              {% endfor %}


            </div>

          </div>
        </div>
      </div>

      <!-- ================= BHK CHOICE ================= -->
      <div class="border overflow-hidden shadow-sm md:shadow-none">

          <div class="flex justify-between items-center px-4 py-3 bg-white active:bg-gray-50">
              <button type="button" onclick="toggleBhkSection()"
                  class="flex-1 flex items-center justify-between text-left">
                  <h4 class="text-sm font-semibold text-gray-800">
                      No. of Bedrooms
                  </h4>
                  <svg id="bhkArrow" class="w-4 h-4 text-gray-500 transition-transform duration-300"
                      fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                  </svg>
              </button>

              <button type="button" onclick="bhkClear()" class="ml-4 text-blue-600 text-sm font-medium hover:underline">
                  Clear
              </button>
          </div>

          <div id="bhkBody" class="hidden px-4 pt-3 pb-4 space-y-3">
              <div class="flex flex-wrap gap-2">

                  {% for bhk in bhk_choices|slice:":5" %}
                  <button type="button" onclick="toggleBhkPill(this)" data-value="{{ bhk }}"
                   class="bhk-pill px-4 py-1.5 rounded-full border text-sm transition font-medium
                        {% if bhk in selected_bhk_list %} 
                          bg-blue-50 border-blue-200 text-blue-600 
                        {% else %} 
                          bg-white border-gray-200 text-gray-600 hover:bg-gray-50 
                        {% endif %}">
                      + {{ bhk }}
                  </button>
                  {% endfor %}

                  <div id="bhkMore" class="hidden flex flex-wrap gap-2">
                      {% for bhk in bhk_choices|slice:"5:" %}
                      <button type="button" onclick="toggleBhkPill(this)" data-value="{{ bhk }}"
                          class="bhk-pill px-4 py-1.5 rounded-full border text-sm transition font-medium
                          {% if bhk in selected_bhk_list %} 
                              bg-blue-50 border-blue-200 text-blue-600 
                          {% else %} 
                              bg-white border-gray-200 text-gray-600 hover:bg-gray-50 
                          {% endif %}">
                          + {{ bhk }}
                      </button>
                      {% endfor %}
                  </div>

              </div>

              {% if bhk_choices|length > 5 %}
              <button id="bhkMoreBtn" type="button" onclick="showMoreBhk()"
                  class="text-sm text-orange-600 font-medium hover:underline mt-2">
                  + {{ bhk_choices|length|add:"-5" }} more
              </button>
              {% endif %}

              <input type="hidden" name="bhk" id="bhkInput" value="{{ selected_bhk|default:'' }}">
          </div>
      </div>

      <!-- ================= CONSTRUCTION STATUS ================= -->
      <div class="border overflow-hidden shadow-sm md:shadow-none">

        <div class="flex justify-between items-center px-4 py-3 bg-white active:bg-gray-50">
          <button type="button" onclick="csToggle()" class="flex-1 flex items-center justify-between text-left">
            
            <h4 class="text-sm font-semibold text-gray-800">
              Construction Status
            </h4>

            <svg id="csArrow" class="w-4 h-4 text-gray-500 transition-transform duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <button type="button" onclick="csClear()" class="ml-4 text-blue-600 text-sm font-medium hover:underline">
            Clear
          </button>
        </div>

        <div id="csBody" class="hidden px-4 pt-3 pb-4">

          <div class="flex flex-wrap gap-2">

            {% for status in construction_status %}
              <button type="button" onclick="csPill(this)" data-value="{{ status }}" class="cs-pill {% if selected_status and status in selected_status %} bg-blue-50 text-blue-600 border-blue-200 {% endif %}">
                + {{ status }}
              </button>
            {% endfor %}
            </div>

          <input type="hidden"  name="construction_status"  id="csInput"  value="{{ selected_status|default:'' }}">
        </div>
      </div>



      <!-- ================= RERA APPROVED ================= -->
      <div class="border overflow-hidden shadow-sm md:shadow-none">

        <!-- HEADER -->
        <div class="flex justify-between items-center px-4 py-3 bg-white">

          <button type="button" onclick="reraToggle()" class="flex items-center gap-2 text-sm font-semibold text-gray-800">
            RERA Approved
            <svg id="reraArrow" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <button type="button" onclick="reraClear()" class="text-blue-600 text-sm font-medium">
            Clear
          </button>
        </div>

        <!-- BODY -->
        <div id="reraBody" class="hidden px-4 pt-3 pb-4 space-y-3">

          <div class="flex flex-wrap gap-2">

            <button type="button" class="rera-pill" onclick="reraSelect(this)" data-value="RERA approved Projects">
              + RERA approved Projects
            </button>

          </div>

          <!-- hidden input -->
          <input type="hidden" name="rera" id="reraInput">
        </div>
      </div>

      <!-- ================= SUBMIT ================= -->
      <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3">
        Filter Properties
      </button>

    </form>
        
      <!-- ================= FILTER BUTTON ================= -->
      <div class="fixed bottom-0 left-0 right-0 p-3 bg-white shadow-lg md:hidden z-50">
        <button type="submit" form="filterForm" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 rounded-xl">
          Search Properties
        </button>
      </div>

  </aside>


  <div class="lg:col-span-2 space-y-6">

    <div class="flex items-center gap-2 bg-white shadow p-3 mb-4">

      <button id="listViewBtn" class="bg-orange-500 text-white p-2">
        <i class="fas fa-list"></i>
      </button>

      <!-- Grid Button (Desktop only) -->
      <button id="gridViewBtn" class="hidden sm:hidden md:inline-flex items-center justify-center bg-gray-200 text-gray-700 p-[12px] hover:bg-orange-100 hover:text-orange-600 transition">
        <i class="fas fa-th"></i>
      </button>

      <span class="font-semibold text-orange-600">
        Properties
      </span>

    </div>

    <!-- âœ… List View -->
    <div id="listView" class="space-y-6">
      {% for project in projects %}

        <div class="flex flex-col sm:flex-row bg-white  shadow border p-3 hover:border-orange-500 hover:shadow-xl transition-all ">

          <a href="{{ project.get_absolute_url }}">
          <!-- Project Image -->
          {% if project.image %}
            <img src="{{ project.image.url }}"  class="w-full sm:w-64 h-48 object-cover mt-0" style="height: 250px;"  alt="{{ project.project_name }}" class="h-80">
          {% else %}
            <img src="{% static 'images/no-images.jpg' %}"  class="w-full sm:w-64 h-48 object-cover" style="height: 250px;"  alt="No Image">
          {% endif %}

          </a>

          <!-- Right Section -->
          <div class="sm:ml-5 sm:mt-0 flex-1 space-y-2">

          <!-- Title + Price + Location -->
          <div class="flex flex-col gap-1">

            <a href="{{ project.get_absolute_url }}" class="block rounded-lg p-1 hover:bg-gray-50 transition-all duration-200">

              <!-- Row 1 -->
              <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-1">

                <!-- Project Name -->
                <h2 class="text-[17px] sm:text-xl font-semibold text-gray-900 leading-snug tracking-tight">
                  {{ project.project_name }}
                </h2>

                <!-- Price -->
                <span class="text-[18px] sm:text-xl font-bold text-orange-600 tracking-tight drop-shadow-sm">
                  {{ project.get_price_range }}
                </span>

              </div>

              <!-- Row 2: Location -->
              <p class="text-[13px] sm:text-sm text-gray-500 flex items-center gap-1 mt-1">

                <i class="fas fa-map-marker-alt text-orange-500 text-[12px]"></i>

                <span class="leading-none">
                  {{ project.locality }}
                </span>

              </p>

            </a>
          </div>


          <!-- Badges -->
          <div class="flex flex-wrap gap-2 text-xs text-gray-700 mb-[10px]">
            <span class="px-2 py-1 rounded-full bg-gray-100">{{ project.construction_status }}</span>
            <span class="px-2 py-1 rounded-full bg-gray-100">{{ project.propert_type }}</span>
            <span class="px-2 py-1 rounded-full bg-gray-100">Possession {{ project.possession_month|default:"N/A" }}--{{ project.possession_year|default:"N/A" }}</span>
          </div>

    
        <!-- ================= CONFIGURATION CARD ================= -->
          <div class="config-card border bg-white">
            {% with project.configurations.all as configs %}
            {% if configs %}
            {% regroup configs by bhk_type as bhk_groups %}

            <div class="relative  overflow-x-auto">
              <div class="bhk-tabs flex gap-1 text-sm font-semibold whitespace-nowrap relative">

                <!-- Animated underline -->
                <span class="bhk-underline absolute bottom-0 h-[3px]"></span>

                {% for group in bhk_groups %}
                  <button type="button"
                    class="bhk-tab px-2  transition-all duration-200
                    {% if group.list|length == 0 %}
                      bhk-disabled
                    {% endif %}"
                    data-target="bhk-{{ project.id }}-{{ forloop.counter }}">
                    {{ group.grouper }}
                  </button>
                {% endfor %}

              </div>
            </div>



            <!-- ================= PANELS ================= -->
            {% for group in bhk_groups %}
            <div class="bhk-panel {% if not forloop.first %}hidden{% endif %}" data-panel="bhk-{{ project.id }}-{{ forloop.counter }}">

            <div class="table-scroll bg-white top-0">

              <table class="w-full text-xs sm:text-sm">
                <thead class="bg-gray-100">
                  <tr class="text-center font-semibold">
                    <th class="border px-2 py-1">Area</th>
                    <th class="border px-2 py-1">Price</th>
                    <th class="border px-2 py-1">Parking</th>
                    <th class="border px-2 py-1">Balcony</th>
                  </tr>
                </thead>

                <tbody class="text-center">
                  {% for cfg in group.list %}
                  <tr class="{% if cfg.sold_out %}bg-red-50{% endif %}">
                    <td class="border px-1 py-1">{{ cfg.area_sqft }} sqft</td>

                    <td class="border px-1 py-1 font-semibold">
                      {% if cfg.sold_out %}
                        <span class="text-red-600 text-xs uppercase font-bold">Sold Out</span>
                      {% else %}
                        {{ cfg.formatted_price }}
                      {% endif %}
                    </td>

                    <td class="border px-1 py-1">
                      {% if cfg.parking %}
                        <span class="text-green-600 font-semibold">Yes</span>
                      {% else %}
                        <span class="text-gray-500">*</span>
                      {% endif %}
                    </td>

                    <td class="border px-1 py-1">
                      {% if cfg.balcony %}
                        <span class="text-green-600 font-semibold">Yes</span>
                      {% else %}
                        <span class="text-gray-500">*</span>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>

            </div>

            </div>
            {% endfor %}

            {% else %}
            <!-- ================= NO CONFIG ================= -->
            <div class="text-center text-sm text-gray-500 py-3">
              Configuration details available on request
            </div>
            {% endif %}
            {% endwith %}

          </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-2.5 items-center">

              <!-- ================= DEVELOPER ================= -->
              {% if project.developer %}
              <div class="flex items-center gap-2">

                <!-- Developer Logo -->
                <span class="h-8 w-8 flex items-center justify-center rounded-full overflow-hidden border bg-gray-100">
                  {% if project.developer.logo %}
                    <img src="{{ project.developer.logo.url }}"
                        alt="{{ project.developer.title }}"
                        class="h-[90px] w-full object-cover">
                  {% else %}
                    <i class="fas fa-building text-gray-400 text-sm"></i>
                  {% endif %}
                </span>

                <!-- Developer Name -->
                <span class="text-blue-600 text-sm font-medium">
                  By {{ project.developer.title }}
                </span>

              </div>
              {% endif %}


              <!-- CTA BUTTONS -->
              <div class="flex gap-3 md:justify-end">

                    <!-- View Details -->
                    <a href="{{ project.get_absolute_url }}" class="flex-1 md:flex-none inline-flex items-center justify-center gap-2  px-4 py-2 bg-orange-500 text-white text-sm font-semibold  rounded-3xl hover:bg-orange-600 transition">
                      View Details
                      
                    </a>

                    <!-- Contact Us -->
                    <a href="javascript:void(0)" data-project="{{ project.project_name }}" data-project-id="{{ project.id }}" class="openContactPopup flex-1 md:flex-none inline-flex items-center justify-center gap-2
                    px-4 py-2 border border-orange-500 text-orange-600 text-sm font-semibold rounded-3xl hover:bg-orange-50 transition">
                      Contact Us
                    </a>
              </div>
            </div>
          </div>
        </div>
      

      {% empty %}
      <div class="text-center text-gray-500 py-10">No projects found.</div>
      {% endfor %}
    </div>

    <!-- ================= GRID VIEW ================= -->
    <div id="gridView" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6">

          {% for project in projects %}
          <div class="bg-white shadow border hover:shadow-lg hover:border-orange-500 transition">

            <!-- IMAGE -->
            <a href="{{ project.get_absolute_url }}">
              {% if project.image %}
                <img src="{{ project.image.url }}" class="w-full h-[230px] object-cover"
                    alt="{{ project.project_name }}">
              {% else %}
                <img src="{% static 'images/no-images.jpg' %}" class="w-full h-[230px] object-cover"
                    alt="No Image">
              {% endif %}
            </a>

            <!-- CONTENT -->
            <div class="p-4 space-y-3">

              <!-- TITLE + PRICE -->
              <div class="flex justify-between items-start gap-3">
                <h3 class="text-lg font-semibold text-gray-900 leading-snug">
                  {{ project.project_name }}
                </h3>

                <span class="text-sm font-bold text-gray-900 whitespace-nowrap">
                  {{ project.get_price_range }}
                </span>
              </div>

              <!-- LOCATION -->
              <p class="text-xs text-gray-500 flex items-center gap-1">
                <i class="fas fa-map-marker-alt text-orange-500"></i>
                {{ project.locality }}, {{ project.city }}
              </p>

              <!-- BADGES -->
              <div class="flex flex-wrap gap-2 text-[11px] text-gray-700">
                <span class="px-2 py-0.5 rounded-full bg-gray-100">
                  {{ project.construction_status }}
                </span>
                <span class="px-2 py-0.5 rounded-full bg-gray-100">
                  {{ project.propert_type.name }}
                </span>
              </div>

              <!-- ================= CONFIGURATION BOX ================= -->
              <div class="border  bg-white text-xs">

                {% with project.configurations.all as configs %}
                {% if configs %}

                {% regroup configs by bhk_type as bhk_groups %}

                <!-- ================= TABS ================= -->
                <div class="border-b px-3 pt-2 overflow-x-auto whitespace-nowrap">
                  <div class="flex gap-4 font-semibold text-gray-600">
                    {% for group in bhk_groups %}
                    <button type="button"
                      class="bhk-tab pb-1 border-b-2
                      {% if forloop.first %}
                        border-orange-500 text-orange-600
                      {% else %}
                        border-transparent hover:text-orange-600
                      {% endif %}"
                      data-target="grid-bhk-{{ project.id }}-{{ forloop.counter }}">
                      {{ group.grouper }}
                    </button>
                    {% endfor %}
                  </div>
                </div>

                <!-- ================= PANELS ================= -->
                {% for group in bhk_groups %}
                <div class="bhk-panel {% if not forloop.first %}hidden{% endif %}"
                    data-panel="grid-bhk-{{ project.id }}-{{ forloop.counter }}">

                  <!-- HEADER -->
                  <div class="grid grid-cols-4 px-3 py-2 bg-gray-50 border-b
                              font-semibold text-gray-600 uppercase text-[10px]">
                    <span>Area</span>
                    <span>Balcony</span>
                    <span>Parking</span>
                    <span class="text-right">Price</span>
                  </div>

                  <!-- BODY -->
                  <div class="max-h-[120px] overflow-y-auto divide-y">

                    {% for cfg in group.list %}
                    <div class="grid grid-cols-4 px-3 py-1 items-center {% if cfg.sold_out %}bg-red-50{% endif %}">

                      <!-- AREA -->
                      <span class="text-gray-700">
                        {{ cfg.area_sqft }} sqft
                      </span>

                      <!-- BALCONY -->
                      <span class="text-gray-500">
                        {% if cfg.balcony %}Yes{% else %}No{% endif %}
                      </span>

                      <!-- PARKING -->
                      <span class="text-gray-500">
                        {% if cfg.parking %}Yes{% else %}No{% endif %}
                      </span>

                      <!-- PRICE / SOLD OUT -->
                      <span class="text-right font-semibold">
                        {% if cfg.sold_out %}
                          <span class="text-red-600 uppercase text-[10px]">
                            Sold Out
                          </span>
                        {% else %}
                          {% if cfg.price_in_rupees %}
                              {{ cfg.formatted_price }}
                          {% else %}
                            On Request
                          {% endif %}
                        {% endif %}
                      </span>

                    </div>
                    {% endfor %}

                  </div>
                </div>
                {% endfor %}

                {% else %}
                <!-- ================= NO CONFIG ================= -->
                <div class="px-3 py-3 text-center text-gray-500">
                  Configuration available on request
                </div>
                {% endif %}
                {% endwith %}

              </div>

                      <!-- Developer -->
                {% if project.developer %}
                <div class="flex items-center gap-2">
                {% if project.developer.logo %}
                  <span class="h-8 w-8 flex items-center justify-center rounded-full overflow-hidden border">
                    <img src="{{ project.developer.logo.url }}"
                        alt="{{ project.developer.title }}"
                        class="h-full w-full object-cover">
                  </span>
                {% endif %}

                  <span class="text-blue-600 text-sm font-medium">
                    {{ project.developer.title }}
                  </span>
                </div>
                {% endif %}



              <!-- CTA -->
              <div class="flex gap-3 pt-2">
                <a href="{{ project.get_absolute_url }}"
                  class="flex-1 text-center px-3 py-2 bg-orange-500 text-white
                          text-sm font-semibold rounded-full hover:bg-orange-600">
                  View Details
                </a>

                <a href="javascript:void(0)"
                  class="flex-1 text-center px-3 py-2 border border-orange-500
                          text-orange-600 text-sm font-semibold rounded-full">
                  Contact
                </a>
              </div>

            </div>
          </div>
          {% empty %}
          <div class="col-span-2 text-center text-gray-500 py-10">
            No projects found.
          </div>
          {% endfor %}
    </div>

      <!-- Pagination Section -->
      {% if projects.has_other_pages %}
        <nav class="flex justify-center mt-10">
          <ul class="flex items-center gap-2 text-gray-700">

            {% if projects.has_previous %}
              <li>
                <a href="?{% param_replace page=projects.previous_page_number %}" 
                  class="px-3 py-1 border rounded hover:bg-gray-200 transition">
                  &laquo; Prev
                </a>
              </li>
            {% else %}
              <li class="px-3 py-1 text-gray-400 border rounded cursor-not-allowed">
                &laquo; Prev
              </li>
            {% endif %}

            {% for num in projects.paginator.page_range %}
              {% if projects.number == num %}
                <li class="px-3 py-1 bg-[#00E0FF] text-white rounded font-bold">
                  {{ num }}
                </li>
              {% elif num > projects.number|add:'-3' and num < projects.number|add:'3' %}
                <li>
                  <a href="?{% param_replace page=num %}" 
                    class="px-3 py-1 border rounded hover:bg-gray-200 transition">
                    {{ num }}
                  </a>
                </li>
              {% endif %}
            {% endfor %}

            {% if projects.has_next %}
              <li>
                <a href="?{% param_replace page=projects.next_page_number %}" 
                  class="px-3 py-1 border rounded hover:bg-gray-200 transition">
                  Next &raquo;
                </a>
              </li>
            {% else %}
              <li class="px-3 py-1 text-gray-400 border rounded cursor-not-allowed">
                Next &raquo;
              </li>
            {% endif %}

          </ul>
        </nav>
      {% endif %}

  </div>

</div>



<div id="paginationWrapper" class="flex justify-center mt-10 space-x-3"></div>

<!-- ================= CONTACT POPUP ================= -->
<div id="contactPopup"
     class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50 px-3">

  <div class="relative w-full max-w-sm rounded-xl shadow-2xl bg-white overflow-hidden">

    <!-- HEADER -->
    <div class="bg-gradient-to-r from-orange-500 to-orange-600 px-4 py-3 text-white">
      <h3 class="text-base font-semibold">Enquiry For</h3>
      <p id="enquiryProjectName" class="text-xs opacity-90 mt-0.5">
        Project Name
      </p>
    </div>

    <!-- CLOSE -->
    <button id="closeContactPopup"
            class="absolute top-3 right-3 text-white text-lg">
      âœ•
    </button>

    <!-- FORM -->
    <form method="post" id="enquiryForm"
          class="p-4 space-y-3 text-sm bg-white">
      {% csrf_token %}

      <!-- Honeypot -->
      <input type="text" name="company" class="hidden">

      <!-- reCAPTCHA token -->
      <input type="hidden" name="g-recaptcha-response" id="recaptchaToken">

      <input type="hidden" name="project_id" id="projectIdInput">

      <!-- NAME -->
      <div>
        <label class="font-medium text-gray-600">Full Name</label>
        <input type="text" name="name" required
               class="mt-1 w-full border rounded-md px-3 py-2">
      </div>

      <!-- EMAIL -->
      <div>
        <label class="font-medium text-gray-600">Email</label>
        <input type="email" name="email"
               class="mt-1 w-full border rounded-md px-3 py-2">
      </div>

      <!-- PHONE -->
      <div>
        <label class="font-medium text-gray-600">Mobile</label>
        <input type="tel" name="phone" required
               class="mt-1 w-full border rounded-md px-3 py-2">
      </div>

      <!-- MESSAGE -->
      <div>
        <label class="font-medium text-gray-600">Message</label>
        <textarea name="message" rows="2"
                  class="mt-1 w-full border rounded-md px-3 py-2"></textarea>
      </div>

      <!-- SUBMIT -->
      <button type="submit"
              class="w-full bg-orange-500 text-white py-2.5 rounded-lg font-semibold">
        Submit Enquiry
      </button>

      <p class="text-[11px] text-center text-gray-400">
        ðŸ”’ 100% Privacy Protected
      </p>
    </form>

  </div>
</div>
<!-- ================= END POPUP ================= -->

<style>
/* ================= CONFIG TABLE SCROLL ================= */
.table-scroll {
  max-height: 105px;          /* yahin se height control */
  overflow-y: auto;
  border: 1px solid #e5e7eb;
}

/* Sticky header */
.table-scroll thead th {
  position: sticky;
  top: 0;
  background: #f3f4f6;
  z-index: 5;
}

/* Orange scrollbar */
.table-scroll::-webkit-scrollbar {
  width: 6px;
}
.table-scroll::-webkit-scrollbar-thumb {
  background: #fb923c;
  border-radius: 10px;
}

</style>


<script>
document.addEventListener("DOMContentLoaded", function () {

  const popup = document.getElementById("contactPopup");
  const closeBtn = document.getElementById("closeContactPopup");
  const projectNameText = document.getElementById("enquiryProjectName");
  const projectIdInput = document.getElementById("projectIdInput");
  const enquiryForm = document.getElementById("enquiryForm");

  document.querySelectorAll(".openContactPopup").forEach(btn => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();

      const projectName = this.dataset.project;
      const projectId = this.dataset.projectId;

      projectNameText.textContent = projectName;
      projectIdInput.value = projectId;

      enquiryForm.action = `/projects/submit-enquiry/${projectId}/`;

      popup.classList.remove("hidden");
      popup.classList.add("flex");
      document.body.style.overflow = "hidden";
    });
  });

  closeBtn.addEventListener("click", closePopup);

  popup.addEventListener("click", e => {
    if (e.target === popup) closePopup();
  });

  document.addEventListener("keydown", e => {
    if (e.key === "Escape") closePopup();
  });

  function closePopup() {
    popup.classList.add("hidden");
    popup.classList.remove("flex");
    document.body.style.overflow = "";
  }

});
</script>

<script>
function openBHK(e, id) {
  document.querySelectorAll('.bhk-content').forEach(el => el.classList.add('hidden'));
  document.querySelectorAll('.bhk-tab').forEach(el => el.classList.remove('active'));

  document.getElementById(id).classList.remove('hidden');
  e.target.classList.add('active');
}
</script>

<script>
  document.getElementById("city").addEventListener("change", function () {
    fetch(`/ajax/load-localities/?city_id=${this.value}`)
      .then(res => res.json())
      .then(data => {
        let locality = document.getElementById("locality");
        locality.innerHTML = '<option value="">Select Locality</option>';
        data.forEach(l => {
          locality.innerHTML += `<option value="${l.id}">${l.name}</option>`;
        });
      });
  });
</script>

<script>
  document.addEventListener("click", function (e) {

    const tab = e.target.closest(".bhk-tab");
    if (!tab) return;

    const card = tab.closest(".config-card");
    if (!card) return;

    const tabsWrapper = card.querySelector(".bhk-tabs");
    const underline = tabsWrapper.querySelector(".bhk-underline");

    /* ================= RESET TABS ================= */
    card.querySelectorAll(".bhk-tab").forEach(btn => {
      btn.classList.remove("text-green-600");
      btn.classList.add("text-gray-600");
    });

    /* ================= HIDE PANELS ================= */
    card.querySelectorAll(".bhk-panel").forEach(panel => {
      panel.classList.add("hidden");
    });

    /* ================= ACTIVATE TAB ================= */
    tab.classList.remove("text-gray-600");
    tab.classList.add("text-green-600");

    /* ================= MOVE UNDERLINE ================= */
    const tabRect = tab.getBoundingClientRect();
    const wrapperRect = tabsWrapper.getBoundingClientRect();

    underline.style.width = `${tabRect.width}px`;
    underline.style.left = `${tabRect.left - wrapperRect.left}px`;

    /* ================= SHOW PANEL ================= */
    const target = tab.dataset.target;
    const panel = card.querySelector(`[data-panel="${target}"]`);
    if (panel) panel.classList.remove("hidden");

  });
</script>


<script>
document.addEventListener("click", function (e) {

  const tab = e.target.closest(".bhk-tab");
  if (!tab) return;

  const card = tab.closest(".bg-white");
  if (!card) return;

  // reset tabs
  card.querySelectorAll(".bhk-tab").forEach(t => {
    t.classList.remove("border-orange-500", "text-orange-600");
    t.classList.add("border-transparent", "text-gray-600");
  });

  // reset panels
  card.querySelectorAll(".bhk-panel").forEach(p => {
    p.classList.add("hidden");
  });

  // activate
  tab.classList.add("border-orange-500", "text-orange-600");
  tab.classList.remove("border-transparent", "text-gray-600");

  const panel = card.querySelector(`[data-panel="${tab.dataset.target}"]`);
  if (panel) panel.classList.remove("hidden");
});
</script>

<script>
  function activateTab(tab, card) {

    const tabsWrapper = card.querySelector(".bhk-tabs");
    const underline = tabsWrapper.querySelector(".bhk-underline");

    // reset tabs
    card.querySelectorAll(".bhk-tab").forEach(t => {
      t.classList.remove("active");
    });

    // hide panels
    card.querySelectorAll(".bhk-panel").forEach(p => {
      p.classList.add("hidden");
    });

    // activate tab
    tab.classList.add("active");

    // move underline
    const tabRect = tab.getBoundingClientRect();
    const wrapRect = tabsWrapper.getBoundingClientRect();

    underline.style.width = tabRect.width + "px";
    underline.style.left = (tabRect.left - wrapRect.left) + "px";

    // show panel
    const panel = card.querySelector(
      `[data-panel="${tab.dataset.target}"]`
    );
    if (panel) panel.classList.remove("hidden");
  }

  /* ================= CLICK HANDLER ================= */
  document.addEventListener("click", function (e) {
    const tab = e.target.closest(".bhk-tab");
    if (!tab || tab.classList.contains("bhk-disabled")) return;

    const card = tab.closest(".config-card");
    if (!card) return;

    activateTab(tab, card);
  });

  /* ================= AUTO ACTIVATE FIRST TAB ================= */
  document.querySelectorAll(".config-card").forEach(card => {
    const firstTab = card.querySelector(".bhk-tab:not(.bhk-disabled)");
    if (firstTab) activateTab(firstTab, card);
  });
</script>


<style>
/* Glass tabs */
.bhk-tab {
  backdrop-filter: blur(10px);
  background: rgba(255,255,255,0.6);
  color: #4b5563;
}

/* Active tab */
.bhk-tab.active {
  color: #16a34a;
}

/* Disabled tab */
.bhk-disabled {
  opacity: 0.4;
  pointer-events: none;
}

/* Gradient underline */
.bhk-underline {
  background: linear-gradient(90deg, #16a34a, #22c55e);
  width: 0;
  left: 0;
  opacity: 0;
  transition:
    left 0.35s cubic-bezier(0.4, 0, 0.2, 1),
    width 0.35s cubic-bezier(0.4, 0, 0.2, 1);
}
</style>


<style>
      /* ================= BHK TABS SCROLL ================= */
  .bhk-tabs {
    overflow-x: auto;
    scrollbar-width: thin;
    scrollbar-color: #fb923c transparent;
    padding-bottom: 6px;
  }

  .bhk-tabs::-webkit-scrollbar {
    height: 5px;
  }
  .bhk-tabs::-webkit-scrollbar-thumb {
    background: #fb923c;
    border-radius: 10px;
  }

  /* ================= TAB STYLE ================= */
  .bhk-tab {
    position: relative;
    padding: 6px 10px;
    color: #374151;
    white-space: nowrap;
  }

  .bhk-tab.active {
    color: #fb923c;
  }

  /* ================= UNDERLINE ================= */
  .bhk-underline {
    left: 0;
    width: 0;
    background: #fb923c;
    transition: all 0.3s ease;
  }
  .bhk-panel div {
  scrollbar-width: thin;
  scrollbar-color: #fb923c transparent;
}

.bhk-panel div::-webkit-scrollbar {
  width: 6px;
}
.bhk-panel div::-webkit-scrollbar-thumb {
  background: #fb923c;
  border-radius: 10px;
}

</style>

<script>
  function toggleFilter(bodyId, arrowId){
    const body = document.getElementById(bodyId);
    const arrow = document.getElementById(arrowId);

    // close if open
    if(body.dataset.open === "true"){
      body.style.height = "0px";
      body.dataset.open = "false";
      arrow.classList.remove("rotate-180");
    } 
    // open if closed
    else{
      body.style.height = body.scrollHeight + "px";
      body.dataset.open = "true";
      arrow.classList.add("rotate-180");
    }
  }

  // âœ… search filter for locality list
  function filterLocality(){
    const q = document.getElementById("localitySearch").value.toLowerCase().trim();
    const items = document.querySelectorAll(".locality-item");

    items.forEach(item=>{
      const text = item.innerText.toLowerCase();
      item.style.display = text.includes(q) ? "flex" : "none";
    });

    // âœ… IMPORTANT: open panel height update after search filtering
    const body = document.getElementById("localityBody");
    if(body.dataset.open === "true"){
      body.style.height = body.scrollHeight + "px";
    }
  }

  // âœ… Clear locality section
  function clearSection(section){
    if(section === "locality"){
      document.getElementById("localitySearch").value = "";
      document.querySelectorAll(".locality-check").forEach(cb => cb.checked = false);
      filterLocality();
    }
  }

  // âœ… DEFAULT OPEN (if you want open by default)
  window.addEventListener("load", ()=>{
    const body = document.getElementById("localityBody");
    const arrow = document.getElementById("localityArrow");

    body.dataset.open = "flase";
    body.style.height = body.scrollHeight + "px";
    arrow.classList.add("rotate-180");
  });
</script>


<script>
    const listViewBtn = document.getElementById("listViewBtn");
      const gridViewBtn = document.getElementById("gridViewBtn");
      const listView = document.getElementById("listView");
      const gridView = document.getElementById("gridView");

      listViewBtn.addEventListener("click", () => {
        listView.classList.remove("hidden");
        gridView.classList.add("hidden");

        listViewBtn.classList.add("bg-orange-500", "text-white");
        listViewBtn.classList.remove("bg-gray-200", "text-gray-700");

        gridViewBtn.classList.remove("bg-orange-500", "text-white");
        gridViewBtn.classList.add("bg-gray-200", "text-gray-700");
      });

      gridViewBtn.addEventListener("click", () => {
        gridView.classList.remove("hidden");
        listView.classList.add("hidden");

        gridViewBtn.classList.add("bg-orange-500", "text-white");
        gridViewBtn.classList.remove("bg-gray-200", "text-gray-700");

        
        listViewBtn.classList.remove("bg-orange-500", "text-white");
        listViewBtn.classList.add("bg-gray-200", "text-gray-700");
      });
</script>

<link rel="stylesheet" href="{% static 'projects/assets/css/pills.css' %}">
<script src="{% static 'projects/assets/js/pills.js' %}"></script>


{% endblock %}